include "macro_once_inc.dshl"

float4 camera_in_camera_prev_vp_ellipse_center = (0,0,0,0);
float4 camera_in_camera_prev_vp_ellipse_xy_axes = (1,0,0,1);
float4 camera_in_camera_vp_ellipse_center = (0,0,0,0);
float4 camera_in_camera_vp_ellipse_xy_axes = (1,0,0,1);
float camera_in_camera_vp_y_scale = 1.0;
float4 camera_in_camera_vp_uv_remapping = (1,0,1,0);
float camera_in_camera_postfx_lens_view = 0.0;

float camera_in_camera_active = 0.0;
int use_camera_in_camera = 0;
interval use_camera_in_camera: no <1, yes;
assume_if_not_assumed use_camera_in_camera = no;

macro INIT_CAMERA_IN_CAMERA(stage)
  if (use_camera_in_camera == yes) {
    (stage) {
      camera_in_camera_active@f1 = camera_in_camera_active;

      camera_in_camera_prev_minus_vp_ellipse_center@f2 = -(camera_in_camera_prev_vp_ellipse_center.xy);
      camera_in_camera_prev_vp_ellipse_x_axis@f2 = camera_in_camera_prev_vp_ellipse_xy_axes.xy;
      camera_in_camera_prev_vp_ellipse_y_axis@f2 = camera_in_camera_prev_vp_ellipse_xy_axes.zw;
      camera_in_camera_minus_vp_ellipse_center@f2 = -(camera_in_camera_vp_ellipse_center.xy);
      camera_in_camera_vp_ellipse_x_axis@f2 = camera_in_camera_vp_ellipse_xy_axes.xy;
      camera_in_camera_vp_ellipse_y_axis@f2 = camera_in_camera_vp_ellipse_xy_axes.zw;
      camera_in_camera_vp_y_scale@f1 = camera_in_camera_vp_y_scale;
      camera_in_camera_vp_u_remapping@f2 = camera_in_camera_vp_uv_remapping.xy;
      camera_in_camera_vp_v_remapping@f2 = camera_in_camera_vp_uv_remapping.zw;
      camera_in_camera_postfx_lens_view@f1 = camera_in_camera_postfx_lens_view;
    }
  }
endmacro

macro USE_CAMERA_IN_CAMERA(stage)
  hlsl(stage) {
  ##if use_camera_in_camera == yes
    #define USE_CAMERA_IN_CAMERA 1
  ##endif

    #include <camera_in_camera.hlsl>
  }
endmacro

macro INIT_AND_USE_ON_TOP_CAMERA_IN_CAMERA(stage)
  INIT_CAMERA_IN_CAMERA(stage)
  USE_CAMERA_IN_CAMERA(stage)
endmacro

//todo: remove usage when feature-import is implemented
macro IMPORT_ON_TOP_CAMERA_IN_CAMERA(stage)
  INIT_AND_USE_ON_TOP_CAMERA_IN_CAMERA(stage)
endmacro